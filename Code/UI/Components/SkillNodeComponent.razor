@namespace Beastborne.UI.Components
@using Sandbox;
@using Sandbox.UI;
@using Beastborne.Core;
@using Beastborne.Data;
@inherits Panel

<div class="skill-node @GetStateClass() @GetCategoryClass()"
	 style="left: @(Node.X + XOffset)px; top: @(Node.Y)px;"
	 onclick=@OnNodeClicked
	 onmouseover=@OnHover
	 onmouseout=@OnHoverLeave>

	<div class="node-border"></div>
	<div class="node-inner"></div>
	<div class="node-icon">@GetIcon()</div>
	@if (IsUnlocked)
	{
		<div class="node-checkmark">âœ“</div>
	}
</div>

@code {
	public SkillNode Node { get; set; }
	public int XOffset { get; set; } = 0;
	public Action<SkillNode> OnClick { get; set; }
	public Action<SkillNode> OnHoverStart { get; set; }
	public Action OnHoverEnd { get; set; }

	private bool IsUnlocked => TamerManager.Instance?.HasSkill(Node.Id) ?? false;
	private bool CanUnlock => TamerManager.Instance?.CanUnlockSkill(Node.Id) ?? false;

	private string GetStateClass()
	{
		if (IsUnlocked) return "unlocked";
		if (CanUnlock) return "available";
		return "locked";
	}

	private string GetCategoryClass()
	{
		return Node.Category.ToString().ToLower();
	}

	private string GetIcon()
	{
		return Node.Category switch
		{
			SkillCategory.Breeding => "ðŸ§¬",
			SkillCategory.Combat => "âš”",
			SkillCategory.Affinity => "âœ¨",
			SkillCategory.Contract => "ðŸ“œ",
			SkillCategory.Exploration => "ðŸ—º",
			_ => "â—†"
		};
	}

	private void OnNodeClicked()
	{
		OnClick?.Invoke(Node);
	}

	private void OnHover()
	{
		OnHoverStart?.Invoke(Node);
	}

	private void OnHoverLeave()
	{
		OnHoverEnd?.Invoke();
	}
}
