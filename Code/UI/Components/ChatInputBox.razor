@using Sandbox;
@using Sandbox.UI;
@namespace Beastborne.UI.Components
@inherits Panel

<root class="chat-input-wrapper">
	<TextEntry
		class="chat-input"
		@ref="textEntry"
		Text="@inputText"
		Placeholder="Type a message..."
	/>
</root>

@code {
	public Action OnSubmit { get; set; }
	private string inputText = "";
	private TextEntry textEntry;

	public void FocusInput()
	{
		textEntry?.Focus();
		ChatPanel.IsChatFocused = true;
	}

	public string GetText()
	{
		return textEntry?.Text ?? "";
	}

	public void ClearText()
	{
		if ( textEntry != null )
		{
			textEntry.Text = "";
		}
		inputText = "";
		StateHasChanged();
	}

	protected override void OnAfterTreeRender( bool firstTime )
	{
		base.OnAfterTreeRender( firstTime );

		if ( firstTime && textEntry != null )
		{
			textEntry.AddEventListener( "onfocus", ( e ) => OnInputFocus() );
			textEntry.AddEventListener( "onblur", ( e ) => OnInputBlur() );
			textEntry.AddEventListener( "onsubmit", ( e ) => OnSubmit?.Invoke() );
		}
	}

	private void OnInputFocus()
	{
		ChatPanel.IsChatFocused = true;
	}

	private void OnInputBlur()
	{
		ChatPanel.IsChatFocused = false;
	}
}
